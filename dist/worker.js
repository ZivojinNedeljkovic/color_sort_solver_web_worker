(()=>{const e=e=>e[e.length-1],t=e=>4===e.length&&r(e),n=(n,r)=>n.length>0&&r.length<4&&(e(n)===e(r)||0===r.length)&&!t(n);function r(e){for(const t of e)if(t!==e[0])return!1;return!0}function o(e,t){if(n(e,t)&&((e,t)=>{return!(r(e)&&(0===t.length||(n=t,4-n.length<e.length)));var n})(e,t)){[e,t]=[[...e],[...t]];do{t.push(e.pop())}while(n(e,t));return{emptiedBottle:e,filledBottle:t}}}const s=(e,t)=>{if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0};var h=class{constructor(e,t){this.key=e,this.parent=t,this.children=[]}_hasUniqueKeyInBranch(e,t){return!t||!e(this.key,t.key)&&this._hasUniqueKeyInBranch(e,t.parent)}hasUniqueKeyInBranch(e){return this._hasUniqueKeyInBranch(e,this.parent)}getBranchKeys(){const e=[];let t=this;for(;t;)e.push(t.key),t=t.parent;return e.reverse()}};function i(e,t){if(e.length!=e.length)return!1;for(let n=0;n<e.length;n++)if(!s(e[n],t[n]))return!1;return!0}const l=e=>e.reduce(((e,n)=>t(n)?e+1:e),0);var u=class{constructor(e,t){this.onFindSolution=t,this.bestMoveCount=Number.MAX_SAFE_INTEGER,this.foundASolution=!1,this.closedBottlesPreStepInFoundSolution=[],this.search(new h(e,void 0))}removeLastAddedNodeFromParent(e){e.parent?.children.pop()}saveSearchProgress(e){this.bestMoveCount=e.length-1,this.closedBottlesPreStepInFoundSolution=e.map((e=>l(e))),this.foundASolution=!0}madeProgress(e,t){return!this.foundASolution||l(e)>=this.closedBottlesPreStepInFoundSolution[t]}search(e,n=0){const r=e.key;if(this.foundASolution?this.madeProgress(r,n):e.hasUniqueKeyInBranch(i)){if(function(e){for(const n of e)if(!t(n)&&0!==n.length)return!1;return!0}(r)&&n<this.bestMoveCount){const t=e.getBranchKeys();return this.onFindSolution(t),void this.saveSearchProgress(t)}r.forEach(((t,s)=>{r.forEach(((i,l)=>{if(s===l)return;const u=o(t,i);if(!u)return;const{emptiedBottle:a,filledBottle:c}=u,d=[...r];d[s]=a,d[l]=c;const f=new h(d,e);e.children.push(f),this.search(f,n+1)}))})),0===e.children.length&&this.removeLastAddedNodeFromParent(e)}else this.removeLastAddedNodeFromParent(e)}};onmessage=function(e){console.log("hello from worker");const t=JSON.parse(e.data);let n=!1;new u(t,(e=>{n=!0,postMessage(e)})),n||postMessage([])}})();
//# sourceMappingURL=worker.js.map
